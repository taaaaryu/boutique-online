apiVersion: networking.istio.io/v1beta1
kind: Sidecar
metadata:
  name: group-sidecar
  namespace: boutique
spec:
  workloadSelector:
    labels:
      group: "group-*"  # グループPodを対象
  egress:
  - hosts:
    - "./*"  # 同じnamespace内の全サービスを許可
    - "istio-system/*"  # Istioシステムサービスを許可

apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: group-traffic-policy
  namespace: boutique
spec:
  host: "*.boutique.svc.cluster.local"
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL  # mTLSを有効化
